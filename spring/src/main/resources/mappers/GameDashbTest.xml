<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.spring.mapper.GameDashbTestMapper">

    <resultMap id="GameDashbTestEntityResultMap" type="com.ssafy.spring.entity.GameDashbTestEntity">
        <id column="game_id" property="gameId"/>
        <result column="title" property="title"/>
        <result column="description" property="description"/>
        <result column="game_profile_path" property="gameProfilePath"/>
        <result column="people" property="people" typeHandler="com.ssafy.spring.entity.typehandler.IntArrayTypeHandler"/>
        <result column="level" property="level"/>
    </resultMap>

    <resultMap id="GameDashbDetailTestEntityResultMap" type="com.ssafy.spring.entity.GameDashbDetailTestEntity">
        <id column="game_id" property="gameId"/>
        <result column="title" property="gameProfilePath"/>
        <result column="description" property="description"/>
        <result column="image_path" property="imagePath" typeHandler="com.ssafy.spring.entity.typehandler.StringArrayTypeHandler"/>
        <result column="description_video_path" property="descriptionVideoPath"/>
    </resultMap>

    <select id="getGameListTest" resultMap="GameDashbTestEntityResultMap">
        SELECT
            gl.game_id,
            gl.title,
            gl.description,
            gp.game_profile_path,
            gd.people,
            gd.level
        FROM
            game_list as gl
            left join
            game_detail as gd
            on gl.game_id = gd.game_id
            left join
            game_profile as gp
            on gl.game_id = gp.game_id
    </select>

    <select id="getFilteredGameList" resultMap="GameDashbTestEntityResultMap">
        SELECT
            gl.game_id,
            gl.title,
            gl.description,
            gp.game_profile_path,
            gd.people,
            gd.level
        from
            game_list as gl
            left join
            game_detail as gd
            on gl.game_id = gd.game_id
            left join
            game_profile as gp
            on gl.game_id = gp.game_id
        WHERE
            gd.people @>
            <foreach collection="people" item="person" open="ARRAY[" close="]" separator=",">
                #{person}
            </foreach>
            AND gd.level IN
            <foreach collection="level" item="lvl" open="(" close=")" separator=",">
                #{lvl}
            </foreach>
    </select>

    <select id="getGameDetailRule" resultMap="GameDashbDetailTestEntityResultMap">
        SELECT
            gp.game_id,
            gp.game_profile_path,
            gr.description,
            gr.image_path,
            gr.description_video_path
        FROM
            game_profile as gp
            left join
            game_rule as gr
            on gp.game_id = gr.game_id
        WHERE
            gp.game_id = #{gameId}
    </select>
    <select id="getSearchedGameList" resultMap="GameDashbTestEntityResultMap">
        SELECT
            gl.game_id,
            gl.title,
            gl.description,
            gp.game_profile_path,
            gd.people,
            gd.level
        FROM
            game_list as gl
            left join
            game_detail as gd
            on gl.game_id = gd.game_id
            left join
            game_profile as gp
            on gl.game_id = gp.game_id
        WHERE
            gl.title LIKE CONCAT('%', #{title}, '%')
    </select>
</mapper>
